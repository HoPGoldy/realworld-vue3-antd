var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;import{h as s,t as o,U as i,r as d,o as c,d as p,w as m,i as f,f as v,k as y,u as g,j as _,F as b,a3 as h,W as w,m as k,ac as j,X as z,b as S,ae as U,$ as q,a7 as A,ad as x,e as D,a2 as O}from"./vendor.d5b88c84.js";import{d as C,a as P,_ as $}from"./TagList.37334d45.js";import{_ as M}from"./FollowButton.vue_vue&type=style&index=0&lang.d9046770.js";import{l as Y,b as B}from"./index.10a24596.js";import{h as L,g as E}from"./article.c8400a35.js";import{u as F}from"./useLoding.b25ee3b2.js";import{t as H,c as W,r as I}from"./reactivity.esm-bundler.9bcfc38b.js";var R=s({props:{author:{type:null,required:!0},date:{type:String,required:!1,default:""},metaDirection:{type:String,required:!1,default:"vertical"},size:{type:String,required:!1,default:"default"}},setup(e){const t=e,{date:a,metaDirection:l}=o(t),r=i((()=>a.value?C(a.value).format("YYYY-MM-DD HH:mm:ss"):"")),u=i((()=>"horizontal"===l.value?8:2));return(t,a)=>{const n=d("a-avatar"),s=d("a-typography-text"),o=d("a-space");return c(),p(o,null,{default:m((()=>[f(n,{size:e.size,src:e.author.image},null,8,["size","src"]),f(o,{direction:g(l),size:g(u)},{default:m((()=>[f(s,null,{default:m((()=>[v(y(e.author.username),1)])),_:1}),f(s,{type:"secondary"},{default:m((()=>[v(y(g(r)),1)])),_:1})])),_:1},8,["direction","size"])])),_:1})}}});const T=v(" Edit Article "),X=v(" Delete Article ");var G=s({props:{article:{type:null,required:!0}},emits:["update"],setup(e,{emit:s}){const v=e,{article:y}=o(v),{showManageButton:k,deleting:j,onDeleteArticle:z,onUpdateAuthor:S,onUpdateArticle:U}=function(e){const o=h(),d=w(Y),c=i((()=>{var t,a,l;return!(!d||(null==(t=d.value)?void 0:t.username)!==(null==(l=null==(a=e.value)?void 0:a.author)?void 0:l.username))})),{loading:p,run:m}=F((async()=>{await L(e.value.slug),o.push("/home")}));return{showManageButton:c,deleting:p,onDeleteArticle:m,onUpdateAuthor:function(o){const i=(d=((e,t)=>{for(var a in t||(t={}))r.call(t,a)&&n(e,a,t[a]);if(l)for(var a of l(t))u.call(t,a)&&n(e,a,t[a]);return e})({},e.value),t(d,a({author:o})));var d;s("update",i)},onUpdateArticle:function(e){s("update",e)}}}(y);return(e,t)=>{const a=d("router-link"),l=d("a-button"),r=d("a-space");return c(),p(r,{size:32},{default:m((()=>[f(R,{author:g(y).author,date:g(y).updatedAt},null,8,["author","date"]),f(r,null,{default:m((()=>{var e,t;return[g(k)?(c(),_(b,{key:0},[f(l,{key:"edit",size:"small"},{default:m((()=>[f(a,{to:`/editor/${g(y).slug}`},{default:m((()=>[T])),_:1},8,["to"])])),_:1}),f(l,{key:"delete",size:"small",danger:"",loading:g(j),onClick:g(z)},{default:m((()=>[X])),_:1},8,["loading","onClick"])],64)):(c(),_(b,{key:1},[f(M,{followed:null==(e=g(y).author)?void 0:e.following,username:null==(t=g(y).author)?void 0:t.username,size:"small",onUpdate:g(S)},null,8,["followed","username","onUpdate"]),f(P,{article:g(y),size:"small",onUpdate:g(U)},null,8,["article","onUpdate"])],64))]})),_:1})])),_:1})}}}),J=s({props:{slug:{type:null,required:!0}},async setup(e){let t,a;const l=e,r=k(([t,a]=j((()=>E(l.slug))),t=await t,a(),t));z((()=>r.value.title),B,{immediate:!0});const u=function(e){r.value=e};return(e,t)=>{const a=d("a-typography-title"),l=d("a-card"),n=d("v-md-preview"),s=d("a-space");return c(),_("div",null,[f(s,{direction:"vertical",style:{width:"100%"}},{default:m((()=>[f(l,{bordered:!1},{default:m((()=>[f(a,null,{default:m((()=>[v(y(r.value.title),1)])),_:1}),f(G,{article:r.value,onUpdate:u},null,8,["article"])])),_:1}),f(l,{bordered:!1},{default:m((()=>[f(n,{text:r.value.body},null,8,["text"]),f($,{"tag-list":r.value.tagList},null,8,["tag-list"])])),_:1}),f(l,{bordered:!1},{default:m((()=>[f(G,{style:{width:"100%","justify-content":"center"},article:r.value,onUpdate:u},null,8,["article"])])),_:1})])),_:1})])}}});var K=s({props:{data:{type:null,required:!0},selfUsername:{type:String,required:!0},articleSlug:{type:null,required:!0}},emits:["delete"],setup(e,{emit:t}){const a=e,{articleSlug:l,data:r,selfUsername:u}=H(a),n=W((()=>r.value.author.username===u.value)),{loading:s,run:o}=F((async()=>{await async function(e,t){return await S.delete(`/articles/${e}/comments/${t}`)}(l.value,r.value.id),t("delete",r.value.id)}));return(e,t)=>{const a=d("a-card"),l=d("a-col"),u=d("a-button"),i=d("a-row");return c(),_("div",null,[f(a,{bordered:!1},{default:m((()=>[v(y(g(r).body),1)])),_:1}),f(a,{class:"comment-meta",style:{width:"100%","background-color":"#f8f8f8"}},{default:m((()=>[f(i,{justify:"space-between"},{default:m((()=>[f(l,null,{default:m((()=>[f(R,{size:"small",author:g(r).author,date:g(r).updatedAt,"meta-direction":"horizontal"},null,8,["author","date"])])),_:1}),f(l,null,{default:m((()=>[g(n)?(c(),p(u,{key:0,loading:g(s),type:"text",danger:"",size:"small",onClick:g(o)},{icon:m((()=>[f(g(U))])),_:1},8,["loading","onClick"])):q("",!0)])),_:1})])),_:1})])),_:1})])}}});const N=v(" Post Comment ");var Q=s({props:{articleSlug:{type:null,required:!0},selfAvatarSrc:{type:String,required:!0},selfUsername:{type:String,required:!0}},emits:["add"],setup(e,{emit:t}){const a=e,{articleSlug:l,selfAvatarSrc:r}=H(a),u=k(""),{loading:n,run:s}=F((async()=>{const e=await async function(e,t){return(await S.post(`/articles/${e}/comments`,{comment:{body:t}})).comment}(l.value,u.value);t("add",e)}));return(e,t)=>{const a=d("a-textarea"),l=d("a-card"),o=d("a-avatar"),i=d("a-col"),p=d("a-button"),v=d("a-row");return c(),_("div",null,[f(l,{class:"comment-input",bordered:!1},{default:m((()=>[f(a,{value:u.value,"onUpdate:value":t[0]||(t[0]=e=>u.value=e),placeholder:"Write a comment...","auto-size":{minRows:4}},null,8,["value"])])),_:1}),f(l,{class:"comment-meta",style:{width:"100%","background-color":"#f8f8f8"}},{default:m((()=>[f(v,{justify:"space-between"},{default:m((()=>[f(i,null,{default:m((()=>[f(o,{size:"small",src:g(r)},null,8,["src"])])),_:1}),f(i,null,{default:m((()=>[f(p,{type:"primary",loading:g(n),size:"small",onClick:g(s)},{default:m((()=>[N])),_:1},8,["loading","onClick"])])),_:1})])),_:1})])),_:1})])}}});const V=v(" Sign in "),Z=v(" or "),ee=v(" Sign up "),te=v(" to add comments on this article. ");var ae=s({props:{slug:{type:null,required:!0}},setup(e){const t=e,{slug:a}=H(t),l=w(Y,I(void 0)),r=i((()=>l.value?l.value.username:"")),u=i((()=>l.value?l.value.image:"")),n=I([]),s=async()=>{n.value=await async function(e){return(await S.get(`/articles/${e}/comments`)).comments}(a.value)},o=e=>{n.value=n.value.filter((({id:t})=>t!==e))};return s(),(e,t)=>{const i=d("router-link"),v=d("a-typography-text"),y=d("a-space");return c(),p(y,{style:{width:"100%"},direction:"vertical"},{default:m((()=>[g(l)?q("",!0):(c(),p(v,{key:0},{default:m((()=>[f(i,{to:"/login"},{default:m((()=>[V])),_:1}),Z,f(i,{to:"/register"},{default:m((()=>[ee])),_:1}),te])),_:1})),(c(!0),_(b,null,A(n.value,(e=>(c(),p(K,{key:e.id,data:e,"article-slug":g(a),"self-username":g(r),onDelete:o},null,8,["data","article-slug","self-username"])))),128)),f(Q,{"article-slug":g(a),"self-avatar-src":g(u),"self-username":g(r),onAdd:s},null,8,["article-slug","self-avatar-src","self-username"])])),_:1})}}}),le=s({setup(e){const t=O().params.id;return(e,a)=>{const l=d("a-skeleton"),r=d("a-col"),u=d("a-row");return c(),p(u,{type:"flex",justify:"center"},{default:m((()=>[f(r,{md:14,xs:24},{default:m((()=>[(c(),p(x,null,{default:m((()=>[D("div",null,[f(J,{slug:g(t)},null,8,["slug"]),f(ae,{style:{"margin-top":"8px"},slug:g(t)},null,8,["slug"])])])),fallback:m((()=>[f(l,{active:""})])),_:1}))])),_:1})])),_:1})}}});export{le as default};
